(()=>{"use strict";let e=[];function t(){return e}function n(t){e=t}const a=e=>{const[t,n,a]=e.split("/").map(Number);return new Date(a,n-1,t)};let c=[];function s(e){const t={title:e,tasks:[]};c.push(t)}function o(e){const t=c.map((e=>e.title.trim().toLowerCase())).indexOf(e.trim().toLowerCase());-1!==t?c.splice(t,1):alert("Project not found.")}function i(){return c}function l(e){return c.find((t=>t.title===e))}function d(e){console.log(e.completed),e.completed=!e.completed,console.log(e.completed)}function r(e,t){const n=t.tasks.map((e=>e.title.trim().toLowerCase())).indexOf(e.trim().toLowerCase());-1!==n?t.tasks.splice(n,1):alert("Task not found.")}function u(){return i().flatMap((e=>e.tasks))}let m=[];function p(){return m}const v=e=>`${String(e.getDate()).padStart(2,"0")}/${String(e.getMonth()+1).padStart(2,"0")}/${e.getFullYear()}`,f=e=>{const[t,n,a]=e.split("/").map(Number);return new Date(a,n-1,t)},g=()=>{const e=new Date;return v(e)};function E(e){const t=(e=>{switch(e){case"Today":return"today";case"This Week":return"week";case"This Month":return"month";case"Overdue":return"overdue";case"All Tasks":return"all";default:return"project"}})(e);switch(t){case"project":(e=>{const t=l(e);m=t.tasks,n(m)})(e);break;case"today":(()=>{const e=u(),t=g();m=e.filter((e=>e.dueDate===t)),n(m)})();break;case"week":(()=>{const e=u(),{start:t,end:a}=(()=>{const e=new Date,t=e.getDate()-e.getDay(),n=new Date(e.setDate(t)),a=new Date(e.setDate(t+6));return{start:v(n),end:v(a)}})();m=e.filter((e=>e.dueDate>=t&&e.dueDate<=a)),n(m)})();break;case"month":(()=>{const e=u();let{start:t,end:a}=(()=>{const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),1),n=new Date(e.getFullYear(),e.getMonth()+1,0);return{start:v(t),end:v(n)}})();t=f(t),a=f(a),m=e.filter((e=>{const n=f(e.dueDate);return n>=t&&n<=a})),n(m)})();break;case"overdue":(()=>{const e=u(),t=g();m=e.filter((e=>e.dueDate<t&&!e.completed)),n(m)})();break;case"all":m=u(),n(m);break;default:return}}function k(){const e=i();localStorage.setItem("projects",JSON.stringify(e))}let y={status:!1,oldTitle:""};function h(e,t){y.status=e,y.oldTitle=t}let L={status:!1,oldTitle:"",projectTitle:""};function B(){return L}const T=document.getElementById("menuBtn"),D=document.getElementById("menuBar"),I=document.getElementById("closeBtn"),C=document.getElementById("addTaskBtn"),N=document.getElementById("formContainer"),w=document.getElementById("addTaskForm"),b=document.getElementById("taskPriority"),j=document.getElementById("selected"),M=document.getElementById("dropDown"),$=M.getElementsByClassName("option"),x=document.getElementById("addProjectBtn"),S=document.getElementById("addProjectForm"),H=document.getElementsByClassName("cancelBtn"),P=document.getElementsByClassName("filter"),F=document.getElementById("sortingInput"),O=document.getElementById("orderBtn"),A=document.getElementById("arrow"),Y=document.getElementById("sortBtn"),W=document.getElementById("heading"),J=()=>{T.addEventListener("click",(()=>{D.classList.toggle("active")})),I.addEventListener("click",(()=>{D.classList.remove("active")}))},q=()=>{C.addEventListener("click",(()=>{h(!1,""),X("","","","Medium"),Z()})),j.addEventListener("click",(()=>{M.classList.toggle("active")}));for(let e=0;e<$.length;e++)$[e].addEventListener("click",(()=>{b.value=$[e].innerText,_($[e].innerText),M.classList.remove("active")}));H[1].addEventListener("click",(()=>{N.classList.remove("active"),w.classList.remove("active")})),w.addEventListener("submit",(e=>{e.preventDefault(),function(){const e=document.getElementById("taskTitle").value,t=document.getElementById("taskDescription").value,n=document.getElementById("taskDueDate").value,a=document.getElementById("taskPriority").value,c=l(document.getElementById("projectSelect").value);!1===L.status?function(e,t,n,a,c){const s={title:e,description:t,dueDate:n,priority:a,completed:!1,project:c.title};c.tasks.push(s)}(e,t,n,a,c):function(e,t,n,a,c,s){const o=function(e,t){return t.tasks.find((t=>t.title===e))}(e,t);o?(o.title=n||o.title,o.description=a||o.description,o.dueDate=c||o.dueDate,o.priority=s||o.priority):alert("Task not found.")}(L.oldTitle,c,e,t,n,a),k(),te()}(),N.classList.remove("active"),w.classList.remove("active")}))},z=()=>{x.addEventListener("click",(()=>{V(""),h(!1,"")})),H[0].addEventListener("click",(()=>{N.classList.remove("active"),S.classList.remove("active")})),S.addEventListener("submit",(e=>{e.preventDefault(),function(){const e=document.getElementById("projectTitle").value.trim();!1===y.status?s(e):function(e,t){l(e).title=t}(y.oldTitle,e),k(),U(),te()}(),N.classList.remove("active"),S.classList.remove("active")}))},G=()=>{P[0].addEventListener("click",(e=>{e.preventDefault(),E("Today"),ee("Today",p()),R(),K(e.target.parentNode)})),P[1].addEventListener("click",(e=>{e.preventDefault(),E("This Week"),ee("This Week",p()),R(),K(e.target.parentNode)})),P[2].addEventListener("click",(e=>{e.preventDefault(),E("This Month"),ee("This Month",p()),R(),K(e.target.parentNode)})),P[3].addEventListener("click",(e=>{e.preventDefault(),E("Overdue"),ee("Overdue",p()),R(),K(e.target.parentNode)})),P[4].addEventListener("click",(e=>{e.preventDefault(),E("All Tasks"),ee("All Tasks",p()),R(),K(e.target.parentNode)}))};function K(e){for(let t=0;t<P.length;t++)P[t]===e?P[t].classList.add("active"):P[t].classList.remove("active")}const Q=()=>{F.addEventListener("change",(()=>{Y.click()})),O.addEventListener("click",(()=>{A.classList.contains("fa-chevron-down")?(A.classList.replace("fa-chevron-down","fa-chevron-up"),O.value="asc"):(A.classList.replace("fa-chevron-up","fa-chevron-down"),O.value="desc"),Y.click()})),Y.addEventListener("click",(()=>{const n=F.value,c=O.value,s=W.innerText;!function(t,n){"Default"==t?(e=p(),e="asc"===n?e:e.reverse()):e.sort(((e,c)=>{let s=0;switch(t){case"Name":o=e.title,i=c.title,s=o.localeCompare(i,void 0,{sensitivity:"base"});break;case"Date":s=((e,t)=>a(e)-a(t))(e.dueDate,c.dueDate);break;case"Priority":s=((e,t)=>{const n={High:1,Medium:2,Low:3};return n[e.priority]-n[t.priority]})(e,c);break;case"Status":s=e.completed-c.completed;break;default:return 0}var o,i;return"asc"===n?-s:s}))}(n,c),ee(s,t())}))};function R(){F.value="Default",A.classList.replace("fa-chevron-up","fa-chevron-down"),O.value="desc"}function U(){const e=i(),n=document.getElementById("projectsList");n.replaceChildren();for(let a=0;a<e.length;a++){const c=e[a].title,s=document.createElement("li");s.className="filter";const i=document.createElement("a");i.innerHTML=`<i class="fa-solid fa-bars-progress"></i> ${c}`,i.addEventListener("click",(e=>{e.preventDefault(),K(e.target.parentNode),E(c);const n=t();ee(c,n)})),s.appendChild(i);const l=document.createElement("button");l.className="editBtn",l.innerHTML='<i class="fa-solid fa-pen-to-square"></i>',l.addEventListener("click",(()=>{V(c),h(!0,c)})),s.appendChild(l);const d=document.createElement("button");d.className="deleteBtn",d.innerHTML='<i class="fa-solid fa-trash"></i>',d.addEventListener("click",(()=>{const e=document.getElementById("defaultActiveLink");o(c),U(),K(e),E("Today"),ee("Today",t()),R()})),s.appendChild(d),n.appendChild(s)}}function V(e){const t=document.getElementById("formContainer"),n=document.getElementById("addProjectForm");document.getElementById("projectTitle").value=e,t.classList.add("active"),n.classList.add("active")}function X(e,t,n,a){const c=document.getElementById("formContainer"),s=document.getElementById("addTaskForm"),o=document.getElementById("taskTitle"),i=document.getElementById("taskDescription"),l=document.getElementById("taskDueDate"),d=document.getElementById("taskPriority");o.value=e,i.value=t,l.value=n,d.value=a,_(a),c.classList.add("active"),s.classList.add("active")}function Z(){const e=i(),t=document.getElementById("projectSelect"),n=B(),a=n.status,c=n.projectTitle;if(!1===a){t.replaceChildren(),t.innerHTML='<option value="" disabled selected hidden>Select Project</option>';for(let n=0;n<e.length;n++)t.innerHTML+=`<option value="${e[n].title}">${e[n].title}</option>`}else t.replaceChildren(),t.innerHTML=`<option value="${c}" selected>${c}</option>`}function _(e){const t=document.getElementById("selected");t.replaceChildren(),t.innerHTML=`<div class="flag ${e}"></div> ${e}`}function ee(e,t=[]){document.getElementById("heading").innerText=e,document.getElementById("tasksCounter").innerHTML=`<i class="fa-solid fa-check"></i> ${t.length} ${1===t.length?"task":"tasks"}`;const n=document.getElementById("content");n.replaceChildren();for(let e=0;e<t.length;e++){const a=t[e],c=document.createElement("li");a.completed?c.classList.add("task","checked"):c.classList.add("task");const s=document.createElement("div");s.className="basicInfos";const o=document.createElement("button");o.className="checkBtn",o.innerHTML='<i class="fa-solid fa-circle-check"></i>',o.addEventListener("click",(()=>{d(a),k(),te()})),s.appendChild(o);const i=document.createElement("h3");i.innerText=a.title,s.appendChild(i),c.appendChild(s);const u=document.createElement("div");u.className="moreInfos";const m=document.createElement("p");m.className="description",m.innerText=a.description,u.appendChild(m);const p=document.createElement("div");p.className="priority",p.innerHTML=`<div class="flag ${a.priority}"></div> <span>${a.priority}</span>`,u.appendChild(p);const v=document.createElement("span");v.className="date",v.innerText=a.dueDate,u.appendChild(v);const f=document.createElement("div");f.className="taskButtons";const g=document.createElement("button");g.className="editTaskBtn",g.innerText="Edit",g.addEventListener("click",(()=>{var e,t;e=a.title,t=a.project,L.status=true,L.oldTitle=e,L.projectTitle=t,X(a.title,a.description,a.dueDate,a.priority),Z()})),f.appendChild(g);const E=document.createElement("button");E.className="deleteTaskBtn",E.innerText="Delete",E.addEventListener("click",(()=>{const e=l(a.project);r(a.title,e),k(),te()})),f.appendChild(E),u.appendChild(f),c.appendChild(u),n.appendChild(c)}}function te(){const e=document.getElementById("heading").innerText;E(e),ee(e,t()),R()}const ne=document.getElementById("taskDueDate");var ae;flatpickr(ne,{dateFormat:"d/m/Y",minDate:"today"}),ae=JSON.parse(localStorage.getItem("projects"))||[],c=ae,n([]),0==i().length&&s("My Project"),U(),E("Today"),ee("Today",t()),J(),q(),z(),G(),Q()})();